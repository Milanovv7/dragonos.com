<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DragonOS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        .wallpaper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            transition: opacity 0.5s ease;
        }

        body.dark-mode .wallpaper.light {
            opacity: 0;
        }

        body:not(.dark-mode) .wallpaper.dark {
            opacity: 0;
        }

        /* Lock Screen */
        .lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(20px);
            background: rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .lock-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .lock-time {
            font-size: 96px;
            font-weight: 200;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }

        .lock-date {
            font-size: 32px;
            font-weight: 300;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 60px;
        }

        .unlock-prompt {
            color: white;
            font-size: 18px;
            margin-top: 40px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* Desktop */
        .desktop {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .desktop.visible {
            opacity: 1;
        }

        /* Top Bar */
        .top-bar {
            height: 32px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(30px) saturate(180%);
            display: flex;
            align-items: center;
            padding: 0 16px;
            color: white;
            font-size: 14px;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dark-mode .top-bar {
            background: rgba(30, 30, 30, 0.7);
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .dragon-menu {
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .dragon-menu:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .menu-text {
            font-weight: 600;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .menu-text:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .top-bar-icon {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .top-bar-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Start Menu */
        .start-menu {
            position: absolute;
            top: 40px;
            left: 16px;
            width: 320px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(40px) saturate(180%);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 200;
        }

        .dark-mode .start-menu {
            background: rgba(40, 40, 40, 0.9);
            color: white;
        }

        .start-menu.visible {
            display: block;
            animation: menuSlide 0.2s ease;
        }

        @keyframes menuSlide {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-box {
            width: 100%;
            padding: 10px 12px;
            border: none;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.1);
            margin-bottom: 12px;
            font-size: 14px;
            outline: none;
        }

        .dark-mode .search-box {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .app-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .app-item:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .dark-mode .app-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .app-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 6px;
        }

        .app-name {
            font-size: 12px;
            text-align: center;
        }

        .lock-button {
            width: 100%;
            padding: 12px;
            margin-top: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.1);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .lock-button:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        .dark-mode .lock-button {
            background: rgba(255, 255, 255, 0.1);
        }

        .dark-mode .lock-button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Dock */
        .dock {
            position: fixed;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(30px) saturate(180%);
            border-radius: 16px;
            padding: 8px 12px;
            display: flex;
            gap: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .dark-mode .dock {
            background: rgba(40, 40, 40, 0.7);
        }

        .dock-item {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .dock-item:hover {
            transform: scale(1.2) translateY(-8px);
        }

        /* Window */
        .window {
            position: absolute;
            width: 600px;
            height: 400px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(40px) saturate(180%);
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .dark-mode .window {
            background: rgba(40, 40, 40, 0.95);
            color: white;
        }

        .window.visible {
            display: flex;
        }

        .window.minimized {
            transform: scale(0) translateY(100vh);
            opacity: 0;
            pointer-events: none;
        }

        .window.maximized {
            width: calc(100vw - 20px) !important;
            height: calc(100vh - 52px) !important;
            top: 10px !important;
            left: 10px !important;
            border-radius: 0;
        }

        .window-header {
            height: 40px;
            background: rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            padding: 0 12px;
            cursor: move;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .dark-mode .window-header {
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .window-buttons {
            display: flex;
            gap: 8px;
        }

        .window-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }

        .window-button.close {
            background: #ff5f56;
        }

        .window-button.minimize {
            background: #ffbd2e;
        }

        .window-button.maximize {
            background: #27c93f;
        }

        .window-title {
            flex: 1;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }

        .window-content {
            flex: 1;
            padding: 20px;
            overflow: auto;
        }

        /* Settings Panel */
        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section h3 {
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
        }

        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .wallpaper-option {
            width: 100%;
            height: 80px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
            object-fit: cover;
        }

        .wallpaper-option:hover {
            transform: scale(1.05);
        }

        .wallpaper-option.active {
            border-color: #007AFF;
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.3);
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 12px;
        }

        .color-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: white;
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.3);
        }

        /* Browser */
        .browser-toolbar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .dark-mode .browser-toolbar {
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .browser-btn {
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .browser-btn:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        .dark-mode .browser-btn {
            background: rgba(255, 255, 255, 0.1);
        }

        .dark-mode .browser-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .browser-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .url-bar {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.1);
            font-size: 14px;
            outline: none;
        }

        .dark-mode .url-bar {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .tabs-container {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.03);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .dark-mode .tabs-container {
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
            min-width: 150px;
            max-width: 200px;
            transition: background 0.2s;
        }

        .tab:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .tab.active {
            background: rgba(0, 122, 255, 0.2);
        }

        .dark-mode .tab {
            background: rgba(255, 255, 255, 0.05);
        }

        .dark-mode .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .dark-mode .tab.active {
            background: rgba(0, 122, 255, 0.3);
        }

        .tab-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tab-close {
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .tab-close:hover {
            opacity: 1;
        }

        .new-tab-btn {
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
        }

        .new-tab-btn:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        .dark-mode .new-tab-btn {
            background: rgba(255, 255, 255, 0.1);
        }

        .dark-mode .new-tab-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .browser-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        /* Start Menu Fullscreen */
        .start-menu.fullscreen {
            width: 100vw;
            height: 100vh;
            top: 0;
            left: 0;
            border-radius: 0;
            max-width: none;
        }

        .start-menu.fullscreen .app-grid {
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
        }

        .start-menu.fullscreen .app-item {
            padding: 20px;
        }

        .start-menu.fullscreen .app-icon {
            width: 64px;
            height: 64px;
            font-size: 32px;
        }

        .start-menu.fullscreen .app-name {
            font-size: 14px;
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .expand-btn {
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .expand-btn:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        .dark-mode .expand-btn {
            background: rgba(255, 255, 255, 0.1);
        }

        .dark-mode .expand-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Mini Calendar */
        .mini-calendar {
            position: absolute;
            top: 40px;
            right: 16px;
            width: 300px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(40px) saturate(180%);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 200;
        }

        .dark-mode .mini-calendar {
            background: rgba(40, 40, 40, 0.95);
            color: white;
        }

        .mini-calendar.visible {
            display: block;
            animation: menuSlide 0.2s ease;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .calendar-nav {
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .dark-mode .calendar-nav {
            background: rgba(255, 255, 255, 0.1);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            text-align: center;
        }

        .calendar-day-name {
            font-size: 12px;
            opacity: 0.6;
            padding: 8px 0;
            font-weight: 600;
        }

        .calendar-day {
            padding: 8px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calendar-day:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .dark-mode .calendar-day:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .calendar-day.today {
            background: var(--accent-color, #007AFF);
            color: white;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        /* Time Format Toggle */
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle-switch:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .dark-mode .toggle-switch {
            background: rgba(255, 255, 255, 0.05);
        }

        .dark-mode .toggle-switch:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .toggle-slider {
            width: 50px;
            height: 28px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 14px;
            position: relative;
            transition: background 0.3s;
        }

        .toggle-slider.active {
            background: var(--accent-color, #007AFF);
        }

        .toggle-knob {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-slider.active .toggle-knob {
            left: 24px;
        }

        /* PIN Lock */
        .pin-section {
            margin-top: 20px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
        }

        .dark-mode .pin-section {
            background: rgba(255, 255, 255, 0.05);
        }

        .pin-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
            letter-spacing: 8px;
            outline: none;
        }

        .dark-mode .pin-input {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .pin-btn {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pin-btn.primary {
            background: #007AFF;
            color: white;
        }

        .pin-btn.primary:hover {
            background: #0051D5;
        }

        .pin-btn.danger {
            background: #FF3B30;
            color: white;
        }

        .pin-btn.danger:hover {
            background: #D70015;
        }

        .pin-status {
            padding: 8px;
            margin: 10px 0;
            border-radius: 6px;
            text-align: center;
            font-size: 13px;
        }

        .pin-status.success {
            background: rgba(52, 199, 89, 0.2);
            color: #34C759;
        }

        .pin-status.error {
            background: rgba(255, 59, 48, 0.2);
            color: #FF3B30;
        }

        .lock-pin-input {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 20px 0;
        }

        .pin-digit {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            font-size: 32px;
            text-align: center;
            color: white;
            outline: none;
        }

        .pin-digit:focus {
            border-color: white;
            background: rgba(255, 255, 255, 0.4);
        }

        .pin-error {
            color: #FF3B30;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .pin-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-width: 300px;
            margin: 20px auto;
        }

        .pin-key {
            padding: 20px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            font-size: 24px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .pin-key:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.05);
        }

        .pin-key:active {
            transform: scale(0.95);
        }

        .pin-display {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin: 30px 0;
        }

        .pin-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.6);
            transition: all 0.2s;
        }

        .pin-dot.filled {
            background: white;
            border-color: white;
        }
    </style>
</head>
<body>
    <img class="wallpaper light" src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop" alt="Light Wallpaper">
    <img class="wallpaper dark" src="https://images.unsplash.com/photo-1419242902214-272b3f66ee7a?w=1920&h=1080&fit=crop" alt="Dark Wallpaper">

    <!-- Lock Screen -->
    <div class="lock-screen" id="lockScreen">
        <div class="lock-time" id="lockTime">12:00</div>
        <div class="lock-date" id="lockDate">Thursday, January 1</div>
        
        <div id="pinLockInterface" style="display: none;">
            <div class="pin-display">
                <div class="pin-dot" id="dot1"></div>
                <div class="pin-dot" id="dot2"></div>
                <div class="pin-dot" id="dot3"></div>
                <div class="pin-dot" id="dot4"></div>
            </div>
            <div class="pin-keypad">
                <div class="pin-key" onclick="enterPinDigit('1')">1</div>
                <div class="pin-key" onclick="enterPinDigit('2')">2</div>
                <div class="pin-key" onclick="enterPinDigit('3')">3</div>
                <div class="pin-key" onclick="enterPinDigit('4')">4</div>
                <div class="pin-key" onclick="enterPinDigit('5')">5</div>
                <div class="pin-key" onclick="enterPinDigit('6')">6</div>
                <div class="pin-key" onclick="enterPinDigit('7')">7</div>
                <div class="pin-key" onclick="enterPinDigit('8')">8</div>
                <div class="pin-key" onclick="enterPinDigit('9')">9</div>
                <div class="pin-key" onclick="clearPin()">‚å´</div>
                <div class="pin-key" onclick="enterPinDigit('0')">0</div>
                <div class="pin-key" onclick="clearPin()">‚úï</div>
            </div>
            <div class="pin-error" id="pinError"></div>
        </div>
        
        <div class="unlock-prompt" id="unlockPrompt">Click anywhere to unlock</div>
    </div>

    <!-- Desktop -->
    <div class="desktop" id="desktop">
        <!-- Top Bar -->
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="top-bar-left">
                <div class="dragon-menu" id="dragonMenu">üêâ</div>
                <div class="menu-text">Finder</div>
                <div class="menu-text">File</div>
                <div class="menu-text">Edit</div>
                <div class="menu-text">View</div>
            </div>
            <div class="top-bar-right">
                <div class="top-bar-icon" id="searchIcon">üîç</div>
                <div class="top-bar-icon" id="darkModeToggle">üåô</div>
                <div class="top-bar-icon" id="battery">üîã <span id="batteryLevel">100%</span></div>
                <div class="top-bar-icon" id="topTime" style="cursor: pointer;">12:00</div>
            </div>
        </div>

        <!-- Mini Calendar -->
        <div class="mini-calendar" id="miniCalendar">
            <div class="calendar-header">
                <button class="calendar-nav" onclick="changeMonth(-1)">‚Üê</button>
                <div id="calendarMonthYear">January 2026</div>
                <button class="calendar-nav" onclick="changeMonth(1)">‚Üí</button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <!-- Start Menu -->
        <div class="start-menu" id="startMenu">
            <div class="menu-header">
                <input type="text" class="search-box" id="searchBox" placeholder="Search DragonOS...">
                <button class="expand-btn" id="expandBtn" onclick="toggleFullscreen()">‚õ∂</button>
            </div>
            <div class="app-grid" id="appGrid">
                <div class="app-item" data-name="Finder" onclick="openWindow('finder')">
                    <div class="app-icon">üìÅ</div>
                    <div class="app-name">Finder</div>
                </div>
                <div class="app-item" data-name="Browser" onclick="openWindow('safari')">
                    <div class="app-icon">üß≠</div>
                    <div class="app-name">Browser</div>
                </div>
                <div class="app-item" data-name="Mail" onclick="openWindow('mail')">
                    <div class="app-icon">‚úâÔ∏è</div>
                    <div class="app-name">Mail</div>
                </div>
                <div class="app-item" data-name="Calendar" onclick="openWindow('calendar')">
                    <div class="app-icon">üìÖ</div>
                    <div class="app-name">Calendar</div>
                </div>
                <div class="app-item" data-name="Photos" onclick="openWindow('photos')">
                    <div class="app-icon">üñºÔ∏è</div>
                    <div class="app-name">Photos</div>
                </div>
                <div class="app-item" data-name="Music" onclick="openWindow('music')">
                    <div class="app-icon">üéµ</div>
                    <div class="app-name">Music</div>
                </div>
                <div class="app-item" data-name="Settings" onclick="openWindow('settings')">
                    <div class="app-icon">‚öôÔ∏è</div>
                    <div class="app-name">Settings</div>
                </div>
                <div class="app-item" data-name="Terminal" onclick="openWindow('terminal')">
                    <div class="app-icon">‚å®Ô∏è</div>
                    <div class="app-name">Terminal</div>
                </div>
                <div class="app-item" data-name="App Store" onclick="openWindow('store')">
                    <div class="app-icon">üõçÔ∏è</div>
                    <div class="app-name">App Store</div>
                </div>
            </div>
            <button class="lock-button" onclick="lockScreen()">
                üîí Lock DragonOS
            </button>
        </div>

        <!-- Dock -->
        <div class="dock">
            <div class="dock-item" onclick="openWindow('finder')" title="Finder">üìÅ</div>
            <div class="dock-item" onclick="openWindow('safari')" title="Browser">üß≠</div>
            <div class="dock-item" onclick="openWindow('mail')" title="Mail">‚úâÔ∏è</div>
            <div class="dock-item" onclick="openWindow('photos')" title="Photos">üñºÔ∏è</div>
            <div class="dock-item" onclick="openWindow('music')" title="Music">üéµ</div>
        </div>

        <!-- Minimized Windows Dock -->
        <div class="dock-minimized-windows" id="minimizedDock" style="display: none;"></div>

        <!-- Windows -->
        <div class="window" id="finderWindow" style="top: 100px; left: 200px;">
            <div class="window-header">
                <div class="window-buttons">
                    <div class="window-button close" onclick="closeWindow('finder')"></div>
                    <div class="window-button minimize" onclick="minimizeWindow('finder')"></div>
                    <div class="window-button maximize" onclick="maximizeWindow('finder')"></div>
                </div>
                <div class="window-title">Finder</div>
                <div style="width: 60px;"></div>
            </div>
            <div class="window-content">
                <h2>üìÅ Files</h2>
                <p>Welcome to the DragonOS Finder!</p>
                <ul style="list-style: none; padding: 20px 0;">
                    <li style="padding: 10px;">üìÑ Documents</li>
                    <li style="padding: 10px;">üñºÔ∏è Pictures</li>
                    <li style="padding: 10px;">üéµ Music</li>
                    <li style="padding: 10px;">üìπ Videos</li>
                    <li style="padding: 10px;">‚¨áÔ∏è Downloads</li>
                </ul>
            </div>
        </div>

        <!-- Settings Window -->
        <div class="window" id="settingsWindow" style="top: 120px; left: 250px; width: 500px; height: 550px;">
            <div class="window-header">
                <div class="window-buttons">
                    <div class="window-button close" onclick="closeWindow('settings')"></div>
                    <div class="window-button minimize" onclick="minimizeWindow('settings')"></div>
                    <div class="window-button maximize" onclick="maximizeWindow('settings')"></div>
                </div>
                <div class="window-title">Settings</div>
                <div style="width: 60px;"></div>
            </div>
            <div class="window-content">
                <div class="settings-section">
                    <h3>üñºÔ∏è Wallpaper</h3>
                    <div class="wallpaper-grid">
                        <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=200&fit=crop" 
                             class="wallpaper-option active" 
                             data-light="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop"
                             data-dark="https://images.unsplash.com/photo-1419242902214-272b3f66ee7a?w=1920&h=1080&fit=crop"
                             onclick="changeWallpaper(this)">
                        <img src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&h=200&fit=crop" 
                             class="wallpaper-option" 
                             data-light="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1920&h=1080&fit=crop"
                             data-dark="https://images.unsplash.com/photo-1532274402911-5a369e4c4bb5?w=1920&h=1080&fit=crop"
                             onclick="changeWallpaper(this)">
                        <img src="https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=400&h=200&fit=crop" 
                             class="wallpaper-option" 
                             data-light="https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=1920&h=1080&fit=crop"
                             data-dark="https://images.unsplash.com/photo-1472214103451-9374bd1c798e?w=1920&h=1080&fit=crop"
                             onclick="changeWallpaper(this)">
                        <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=400&h=200&fit=crop" 
                             class="wallpaper-option" 
                             data-light="https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=1920&h=1080&fit=crop"
                             data-dark="https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1920&h=1080&fit=crop"
                             onclick="changeWallpaper(this)">
                    </div>
                </div>

                <div class="settings-section">
                    <h3>üé® Accent Color</h3>
                    <div class="color-grid">
                        <div class="color-option active" style="background: #007AFF;" onclick="changeAccentColor(this, '#007AFF')"></div>
                        <div class="color-option" style="background: #5856D6;" onclick="changeAccentColor(this, '#5856D6')"></div>
                        <div class="color-option" style="background: #AF52DE;" onclick="changeAccentColor(this, '#AF52DE')"></div>
                        <div class="color-option" style="background: #FF2D55;" onclick="changeAccentColor(this, '#FF2D55')"></div>
                        <div class="color-option" style="background: #FF9500;" onclick="changeAccentColor(this, '#FF9500')"></div>
                        <div class="color-option" style="background: #FFCC00;" onclick="changeAccentColor(this, '#FFCC00')"></div>
                        <div class="color-option" style="background: #34C759;" onclick="changeAccentColor(this, '#34C759')"></div>
                        <div class="color-option" style="background: #00C7BE;" onclick="changeAccentColor(this, '#00C7BE')"></div>
                        <div class="color-option" style="background: #32ADE6;" onclick="changeAccentColor(this, '#32ADE6')"></div>
                        <div class="color-option" style="background: #8E8E93;" onclick="changeAccentColor(this, '#8E8E93')"></div>
                        <div class="color-option" style="background: #FF6482;" onclick="changeAccentColor(this, '#FF6482')"></div>
                        <div class="color-option" style="background: #BF5AF2;" onclick="changeAccentColor(this, '#BF5AF2')"></div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>üîí Security</h3>
                    <div class="pin-section">
                        <div id="noPinSection">
                            <p style="margin-bottom: 12px; font-size: 14px;">Create a 4-digit PIN to lock your DragonOS</p>
                            <input type="password" class="pin-input" id="newPinInput" placeholder="Enter 4-digit PIN" maxlength="4" inputmode="numeric">
                            <input type="password" class="pin-input" id="confirmPinInput" placeholder="Confirm PIN" maxlength="4" inputmode="numeric">
                            <button class="pin-btn primary" onclick="createPin()">Create PIN Lock</button>
                            <div id="pinCreateStatus"></div>
                        </div>
                        <div id="hasPinSection" style="display: none;">
                            <div class="pin-status success">‚úì PIN Lock is enabled</div>
                            <button class="pin-btn danger" onclick="removePin()">Remove PIN Lock</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>üïê Time & Date</h3>
                    <div class="toggle-switch" onclick="toggle24Hour()">
                        <div>Use 24-hour time</div>
                        <div style="flex: 1;"></div>
                        <div class="toggle-slider" id="timeFormatToggle">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Window -->
        <div class="window" id="calendarWindow" style="top: 120px; left: 350px; width: 350px; height: 450px;">
            <div class="window-header">
                <div class="window-buttons">
                    <div class="window-button close" onclick="closeWindow('calendar')"></div>
                    <div class="window-button minimize" onclick="minimizeWindow('calendar')"></div>
                    <div class="window-button maximize" onclick="maximizeWindow('calendar')"></div>
                </div>
                <div class="window-title">Calendar</div>
                <div style="width: 60px;"></div>
            </div>
            <div class="window-content" style="padding: 12px;">
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="changeMonth(-1)">‚Üê</button>
                    <div id="calendarWindowMonthYear" style="font-weight: 600; font-size: 16px;">January 2026</div>
                    <button class="calendar-nav" onclick="changeMonth(1)">‚Üí</button>
                </div>
                <div class="calendar-grid" id="calendarWindowGrid" style="margin-top: 16px;"></div>
            </div>
        </div>

        <!-- Browser Window -->
        <div class="window" id="safariWindow" style="top: 80px; left: 300px; width: 900px; height: 600px;">
            <div class="window-header">
                <div class="window-buttons">
                    <div class="window-button close" onclick="closeWindow('safari')"></div>
                    <div class="window-button minimize" onclick="minimizeWindow('safari')"></div>
                    <div class="window-button maximize" onclick="maximizeWindow('safari')"></div>
                </div>
                <div class="window-title">Browser</div>
                <div style="width: 60px;"></div>
            </div>
            <div style="display: flex; flex-direction: column; flex: 1; overflow: hidden;">
                <div class="tabs-container" id="tabsContainer">
                    <button class="new-tab-btn" onclick="createNewTab()" title="New Tab">+</button>
                </div>
                <div class="browser-toolbar">
                    <button class="browser-btn" id="backBtn" onclick="goBack()" disabled>‚Üê</button>
                    <button class="browser-btn" id="forwardBtn" onclick="goForward()" disabled>‚Üí</button>
                    <button class="browser-btn" onclick="reloadPage()">‚ü≥</button>
                    <input type="text" class="url-bar" id="urlBar" placeholder="Enter URL or search..." onkeypress="handleUrlEnter(event)">
                </div>
                <div style="flex: 1; overflow: hidden; position: relative;" id="browserContent"></div>
            </div>
        </div>
    </div>

    <script>
        let isDarkMode = false;
        let currentAccentColor = '#007AFF';
        let lightWallpaper = 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920&h=1080&fit=crop';
        let darkWallpaper = 'https://images.unsplash.com/photo-1419242902214-272b3f66ee7a?w=1920&h=1080&fit=crop';

        // Browser state
        let tabs = [];
        let activeTabId = null;
        let tabIdCounter = 0;

        // PIN state
        let userPin = null;
        let enteredPin = '';

        // Calendar state
        let currentCalendarDate = new Date();

        // Time format (true = 24h, false = 12h)
        let use24Hour = false;

        // Battery API
        let batteryManager = null;

        // Minimized windows tracking
        let minimizedWindows = new Set();
        let windowStates = {}; // Store original position and size

        // Load saved settings
        function loadSettings() {
            const saved = localStorage.getItem('dragonOSSettings');
            if (saved) {
                try {
                    const settings = JSON.parse(saved);
                    isDarkMode = settings.isDarkMode || false;
                    currentAccentColor = settings.accentColor || '#007AFF';
                    lightWallpaper = settings.lightWallpaper || lightWallpaper;
                    darkWallpaper = settings.darkWallpaper || darkWallpaper;
                    userPin = settings.pin !== undefined ? settings.pin : null;
                    use24Hour = settings.use24Hour || false;

                    // Apply settings
                    if (isDarkMode) {
                        document.body.classList.add('dark-mode');
                        document.getElementById('darkModeToggle').textContent = '‚òÄÔ∏è';
                    }
                    document.querySelector('.wallpaper.light').src = lightWallpaper;
                    document.querySelector('.wallpaper.dark').src = darkWallpaper;
                    document.documentElement.style.setProperty('--accent-color', currentAccentColor);

                    // Update UI
                    updateWallpaperSelection();
                    updateColorSelection();
                    updatePinUI();
                    updateTimeFormatToggle();
                } catch (e) {
                    console.error('Error loading settings:', e);
                    // Reset to defaults on error
                    userPin = null;
                }
            }
        }

        function saveSettings() {
            const settings = {
                isDarkMode,
                accentColor: currentAccentColor,
                lightWallpaper,
                darkWallpaper,
                pin: userPin,
                use24Hour
            };
            localStorage.setItem('dragonOSSettings', JSON.stringify(settings));
        }

        function updateWallpaperSelection() {
            document.querySelectorAll('.wallpaper-option').forEach(el => {
                if (el.dataset.light === lightWallpaper && el.dataset.dark === darkWallpaper) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
            });
        }

        function updateColorSelection() {
            document.querySelectorAll('.color-option').forEach(el => {
                const color = el.style.background;
                if (color === currentAccentColor || rgbToHex(color) === currentAccentColor) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
            });
        }

        function rgbToHex(rgb) {
            const result = rgb.match(/\d+/g);
            if (!result) return rgb;
            return '#' + result.map(x => parseInt(x).toString(16).padStart(2, '0')).join('').toUpperCase();
        }

        function updatePinUI() {
            if (userPin) {
                document.getElementById('noPinSection').style.display = 'none';
                document.getElementById('hasPinSection').style.display = 'block';
            } else {
                document.getElementById('noPinSection').style.display = 'block';
                document.getElementById('hasPinSection').style.display = 'none';
            }
        }

        function updateTimeFormatToggle() {
            const toggle = document.getElementById('timeFormatToggle');
            if (use24Hour) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }

        // Initialize on load
        loadSettings();

        // Initialize battery
        if ('getBattery' in navigator) {
            navigator.getBattery().then(function(battery) {
                batteryManager = battery;
                updateBatteryStatus();
                
                battery.addEventListener('levelchange', updateBatteryStatus);
                battery.addEventListener('chargingchange', updateBatteryStatus);
            });
        } else {
            document.getElementById('batteryLevel').textContent = 'N/A';
        }

        function updateBatteryStatus() {
            if (batteryManager) {
                const level = Math.floor(batteryManager.level * 100);
                const charging = batteryManager.charging;
                document.getElementById('batteryLevel').textContent = (charging ? '‚ö°' : '') + level + '%';
            }
        }

        // Update time
        function updateTime() {
            const now = new Date();
            let timeStr;
            
            if (use24Hour) {
                timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
            } else {
                timeStr = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
            }
            
            const dateStr = now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
            
            document.getElementById('lockTime').textContent = timeStr;
            document.getElementById('lockDate').textContent = dateStr;
            document.getElementById('topTime').textContent = timeStr;
        }

        updateTime();
        setInterval(updateTime, 1000);

        // Lock screen functions
        function lockScreen() {
            document.getElementById('lockScreen').classList.remove('hidden');
            document.getElementById('desktop').classList.remove('visible');
            document.getElementById('startMenu').classList.remove('visible');
            
            // Show PIN interface if PIN is set
            if (userPin) {
                document.getElementById('pinLockInterface').style.display = 'block';
                document.getElementById('unlockPrompt').style.display = 'none';
                enteredPin = '';
                updatePinDots();
                // Focus on lock screen for keyboard input
                document.getElementById('lockScreen').focus();
            } else {
                document.getElementById('pinLockInterface').style.display = 'none';
                document.getElementById('unlockPrompt').style.display = 'block';
            }
        }

        function unlockScreen() {
            document.getElementById('lockScreen').classList.add('hidden');
            document.getElementById('desktop').classList.add('visible');
            enteredPin = '';
            updatePinDots();
            document.getElementById('pinError').textContent = '';
        }

        // Lock screen unlock
        document.getElementById('lockScreen').addEventListener('click', function(e) {
            // Only unlock if clicking on the lock screen itself and no PIN is set
            if (!userPin) {
                unlockScreen();
            }
        });

        document.getElementById('unlockPrompt').addEventListener('click', function(e) {
            e.stopPropagation();
            if (!userPin) {
                unlockScreen();
            }
        });

        // Keyboard support for PIN entry
        document.addEventListener('keydown', function(e) {
            const lockScreen = document.getElementById('lockScreen');
            if (!lockScreen.classList.contains('hidden') && userPin) {
                if (e.key >= '0' && e.key <= '9') {
                    e.preventDefault();
                    enterPinDigit(e.key);
                } else if (e.key === 'Backspace' || e.key === 'Delete') {
                    e.preventDefault();
                    clearPin();
                } else if (e.key === 'Enter' && enteredPin.length === 4) {
                    e.preventDefault();
                    checkPin();
                }
            }
        });

        // Dragon menu toggle
        document.getElementById('dragonMenu').addEventListener('click', function(e) {
            e.stopPropagation();
            const menu = document.getElementById('startMenu');
            menu.classList.toggle('visible');
        });

        // Search icon opens start menu
        document.getElementById('searchIcon').addEventListener('click', function(e) {
            e.stopPropagation();
            const menu = document.getElementById('startMenu');
            menu.classList.toggle('visible');
        });

        // Time icon opens mini calendar
        document.getElementById('topTime').addEventListener('click', function(e) {
            e.stopPropagation();
            const calendar = document.getElementById('miniCalendar');
            calendar.classList.toggle('visible');
            if (calendar.classList.contains('visible')) {
                renderCalendar('mini');
            }
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('startMenu');
            const dragonMenu = document.getElementById('dragonMenu');
            const searchIcon = document.getElementById('searchIcon');
            const calendar = document.getElementById('miniCalendar');
            const timeIcon = document.getElementById('topTime');
            
            if (!menu.contains(e.target) && !dragonMenu.contains(e.target) && !searchIcon.contains(e.target)) {
                menu.classList.remove('visible');
            }
            
            if (!calendar.contains(e.target) && !timeIcon.contains(e.target)) {
                calendar.classList.remove('visible');
            }
        });

        // Dark mode toggle
        document.getElementById('darkModeToggle').addEventListener('click', function() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            this.textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
            saveSettings();
        });

        // Window management
        function openWindow(windowName) {
            const win = document.getElementById(windowName + 'Window');
            if (win) {
                win.classList.add('visible');
                document.getElementById('startMenu').classList.remove('visible');
                
                // Initialize browser with first tab when opened
                if (windowName === 'safari' && tabs.length === 0) {
                    createNewTab();
                }
                
                // Initialize calendar when opened
                if (windowName === 'calendar') {
                    renderCalendar('window');
                }
            } else {
                // Open system default apps for non-implemented apps
                const appMessages = {
                    'mail': 'Opening default Mail app...',
                    'photos': 'Opening default Photos app...',
                    'music': 'Opening default Music app...',
                    'terminal': 'Opening default Terminal app...',
                    'store': 'Opening default App Store...'
                };
                
                if (appMessages[windowName]) {
                    alert(appMessages[windowName]);
                }
            }
        }

        function closeWindow(windowName) {
            const win = document.getElementById(windowName + 'Window');
            if (win) {
                win.classList.remove('visible');
                minimizedWindows.delete(windowName);
                updateMinimizedDock();
            }
        }

        function minimizeWindow(windowName) {
            const win = document.getElementById(windowName + 'Window');
            if (win) {
                // Store original state if not maximized
                if (!win.classList.contains('maximized')) {
                    windowStates[windowName] = {
                        width: win.style.width,
                        height: win.style.height,
                        top: win.style.top,
                        left: win.style.left
                    };
                }
                win.classList.add('minimized');
                minimizedWindows.add(windowName);
                updateMinimizedDock();
            }
        }

        function restoreWindow(windowName) {
            const win = document.getElementById(windowName + 'Window');
            if (win) {
                win.classList.remove('minimized');
                minimizedWindows.delete(windowName);
                updateMinimizedDock();
            }
        }

        function maximizeWindow(windowName) {
            const win = document.getElementById(windowName + 'Window');
            if (win) {
                if (win.classList.contains('maximized')) {
                    // Restore to original size
                    win.classList.remove('maximized');
                    if (windowStates[windowName]) {
                        win.style.width = windowStates[windowName].width;
                        win.style.height = windowStates[windowName].height;
                        win.style.top = windowStates[windowName].top;
                        win.style.left = windowStates[windowName].left;
                    }
                } else {
                    // Store original state before maximizing
                    windowStates[windowName] = {
                        width: win.style.width,
                        height: win.style.height,
                        top: win.style.top,
                        left: win.style.left
                    };
                    win.classList.add('maximized');
                }
            }
        }

        function updateMinimizedDock() {
            const dock = document.getElementById('minimizedDock');
            dock.innerHTML = '';
            
            if (minimizedWindows.size === 0) {
                dock.style.display = 'none';
                return;
            }
            
            dock.style.display = 'flex';
            
            const windowTitles = {
                finder: 'üìÅ Finder',
                settings: '‚öôÔ∏è Settings',
                safari: 'üß≠ Browser',
                calendar: 'üìÖ Calendar'
            };
            
            minimizedWindows.forEach(windowName => {
                const item = document.createElement('div');
                item.className = 'minimized-window-item';
                item.textContent = windowTitles[windowName] || windowName;
                item.onclick = () => restoreWindow(windowName);
                dock.appendChild(item);
            });
        }

        // Settings functions
        function changeWallpaper(element) {
            document.querySelectorAll('.wallpaper-option').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            
            lightWallpaper = element.dataset.light;
            darkWallpaper = element.dataset.dark;
            
            document.querySelector('.wallpaper.light').src = lightWallpaper;
            document.querySelector('.wallpaper.dark').src = darkWallpaper;
            
            saveSettings();
        }

        function changeAccentColor(element, color) {
            document.querySelectorAll('.color-option').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            currentAccentColor = color;
            
            // Apply accent color to various UI elements
            document.documentElement.style.setProperty('--accent-color', color);
            
            saveSettings();
        }

        function toggle24Hour() {
            use24Hour = !use24Hour;
            updateTimeFormatToggle();
            updateTime();
            saveSettings();
        }

        // Start Menu functions
        function toggleFullscreen() {
            const menu = document.getElementById('startMenu');
            menu.classList.toggle('fullscreen');
            const btn = document.getElementById('expandBtn');
            btn.textContent = menu.classList.contains('fullscreen') ? '‚õ∂' : '‚õ∂';
        }

        // Search functionality
        document.getElementById('searchBox').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const apps = document.querySelectorAll('.app-item');
            
            apps.forEach(app => {
                const name = app.getAttribute('data-name').toLowerCase();
                if (name.includes(query)) {
                    app.style.display = 'flex';
                } else {
                    app.style.display = 'none';
                }
            });
        });

        // PIN functions
        function createPin() {
            const newPin = document.getElementById('newPinInput').value;
            const confirmPin = document.getElementById('confirmPinInput').value;
            const statusEl = document.getElementById('pinCreateStatus');

            if (newPin.length !== 4 || !/^\d{4}$/.test(newPin)) {
                statusEl.innerHTML = '<div class="pin-status error">PIN must be exactly 4 digits</div>';
                return;
            }

            if (newPin !== confirmPin) {
                statusEl.innerHTML = '<div class="pin-status error">PINs do not match</div>';
                return;
            }

            userPin = newPin;
            saveSettings();
            updatePinUI();

            document.getElementById('newPinInput').value = '';
            document.getElementById('confirmPinInput').value = '';
            statusEl.innerHTML = '<div class="pin-status success">‚úì PIN created successfully</div>';
            
            setTimeout(() => {
                statusEl.innerHTML = '';
            }, 3000);
        }

        function removePin() {
            if (confirm('Are you sure you want to remove PIN lock?')) {
                userPin = null;
                saveSettings();
                updatePinUI();
            }
        }

        function enterPinDigit(digit) {
            if (enteredPin.length < 4) {
                enteredPin += digit;
                updatePinDots();
                
                if (enteredPin.length === 4) {
                    checkPin();
                }
            }
        }

        function clearPin() {
            enteredPin = '';
            updatePinDots();
            document.getElementById('pinError').textContent = '';
        }

        function updatePinDots() {
            for (let i = 1; i <= 4; i++) {
                const dot = document.getElementById('dot' + i);
                if (i <= enteredPin.length) {
                    dot.classList.add('filled');
                } else {
                    dot.classList.remove('filled');
                }
            }
        }

        function checkPin() {
            if (enteredPin === userPin) {
                unlockScreen();
                enteredPin = '';
                updatePinDots();
                document.getElementById('pinError').textContent = '';
            } else {
                document.getElementById('pinError').textContent = 'Incorrect PIN';
                setTimeout(() => {
                    enteredPin = '';
                    updatePinDots();
                    document.getElementById('pinError').textContent = '';
                }, 1000);
            }
        }

        // Browser functions
        function createNewTab() {
            const tabId = tabIdCounter++;
            const tab = {
                id: tabId,
                title: 'New Tab',
                url: 'https://www.google.com',
                history: ['https://www.google.com'],
                currentIndex: 0
            };
            
            tabs.push(tab);
            renderTabs();
            switchToTab(tabId);
        }

        function renderTabs() {
            const container = document.getElementById('tabsContainer');
            const newTabBtn = container.querySelector('.new-tab-btn');
            container.innerHTML = '';
            container.appendChild(newTabBtn);
            
            tabs.forEach(tab => {
                const tabEl = document.createElement('div');
                tabEl.className = 'tab' + (tab.id === activeTabId ? ' active' : '');
                tabEl.innerHTML = `
                    <span class="tab-title">${tab.title}</span>
                    <span class="tab-close" onclick="closeTab(${tab.id}, event)">‚úï</span>
                `;
                tabEl.onclick = (e) => {
                    if (!e.target.classList.contains('tab-close')) {
                        switchToTab(tab.id);
                    }
                };
                container.appendChild(tabEl);
            });
        }

        function switchToTab(tabId) {
            activeTabId = tabId;
            const tab = tabs.find(t => t.id === tabId);
            if (!tab) return;
            
            renderTabs();
            document.getElementById('urlBar').value = tab.url;
            
            const content = document.getElementById('browserContent');
            content.innerHTML = '';
            
            const iframe = document.createElement('iframe');
            iframe.className = 'browser-frame';
            iframe.src = tab.url;
            iframe.style.display = 'block';
            content.appendChild(iframe);
            
            updateNavigationButtons();
        }

        function closeTab(tabId, event) {
            event.stopPropagation();
            const index = tabs.findIndex(t => t.id === tabId);
            if (index === -1) return;
            
            tabs.splice(index, 1);
            
            if (tabs.length === 0) {
                document.getElementById('browserContent').innerHTML = '';
                document.getElementById('urlBar').value = '';
                activeTabId = null;
            } else if (activeTabId === tabId) {
                const newActiveTab = tabs[Math.min(index, tabs.length - 1)];
                switchToTab(newActiveTab.id);
            } else {
                renderTabs();
            }
            
            updateNavigationButtons();
        }

        function handleUrlEnter(event) {
            if (event.key === 'Enter') {
                let url = event.target.value.trim();
                
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    if (url.includes('.')) {
                        url = 'https://' + url;
                    } else {
                        url = 'https://www.google.com/search?q=' + encodeURIComponent(url);
                    }
                }
                
                navigateToUrl(url);
            }
        }

        function navigateToUrl(url) {
            const tab = tabs.find(t => t.id === activeTabId);
            if (!tab) return;
            
            tab.history = tab.history.slice(0, tab.currentIndex + 1);
            tab.history.push(url);
            tab.currentIndex = tab.history.length - 1;
            tab.url = url;
            
            const iframe = document.querySelector('#browserContent iframe');
            if (iframe) {
                iframe.src = url;
            }
            
            document.getElementById('urlBar').value = url;
            updateNavigationButtons();
        }

        function goBack() {
            const tab = tabs.find(t => t.id === activeTabId);
            if (!tab || tab.currentIndex <= 0) return;
            
            tab.currentIndex--;
            tab.url = tab.history[tab.currentIndex];
            
            const iframe = document.querySelector('#browserContent iframe');
            if (iframe) {
                iframe.src = tab.url;
            }
            
            document.getElementById('urlBar').value = tab.url;
            updateNavigationButtons();
        }

        function goForward() {
            const tab = tabs.find(t => t.id === activeTabId);
            if (!tab || tab.currentIndex >= tab.history.length - 1) return;
            
            tab.currentIndex++;
            tab.url = tab.history[tab.currentIndex];
            
            const iframe = document.querySelector('#browserContent iframe');
            if (iframe) {
                iframe.src = tab.url;
            }
            
            document.getElementById('urlBar').value = tab.url;
            updateNavigationButtons();
        }

        function reloadPage() {
            const iframe = document.querySelector('#browserContent iframe');
            if (iframe) {
                iframe.src = iframe.src;
            }
        }

        function updateNavigationButtons() {
            const tab = tabs.find(t => t.id === activeTabId);
            const backBtn = document.getElementById('backBtn');
            const forwardBtn = document.getElementById('forwardBtn');
            
            if (!tab) {
                backBtn.disabled = true;
                forwardBtn.disabled = true;
                return;
            }
            
            backBtn.disabled = tab.currentIndex <= 0;
            forwardBtn.disabled = tab.currentIndex >= tab.history.length - 1;
        }

        // Window dragging
        let draggedWindow = null;
        let offsetX, offsetY;

        document.addEventListener('mousedown', function(e) {
            if (e.target.classList.contains('window-header') || e.target.classList.contains('window-title')) {
                draggedWindow = e.target.closest('.window');
                
                // Don't drag if maximized
                if (draggedWindow.classList.contains('maximized')) {
                    draggedWindow = null;
                    return;
                }
                
                const rect = draggedWindow.getBoundingClientRect();
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;
            }
        });

        document.addEventListener('mousemove', function(e) {
            if (draggedWindow && !draggedWindow.classList.contains('maximized')) {
                draggedWindow.style.left = (e.clientX - offsetX) + 'px';
                draggedWindow.style.top = (e.clientY - offsetY) + 'px';
            }
        });

        document.addEventListener('mouseup', function() {
            draggedWindow = null;
        });
    </script>
</body>
</html>
